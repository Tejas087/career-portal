{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="{% static 'css/profile.css' %}" />
</head>
<body>
    <div class="main-header-container">
        <div class="header container">
            <img src="{% static 'images/logo.png' %}" class="logo" alt="Company Logo" />
            <nav>
                <ul>
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="#">Jobs</a></li>
                    <li><a href="#">Companies</a></li>
                    <li><a href="{% url 'profile' %}" class="profile-btn">Profile</a></li>
                    <li><a href="javascript:void(0);" class="logout-trigger">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <section class="profile-page-wrapper">
        {% if not is_editing %}
            <div class="container">
                <div class="profile-card-header">
                    {% if profile.photo %}
                        <img src="{{ profile.photo.url }}" alt="Profile Photo" class="profile-avatar" />
                    {% else %}
                        <div class="profile-avatar-placeholder">
                            <i class="fas fa-user-circle"></i>
                        </div>
                    {% endif %}

                    <div class="header-info">
                        <h1>{{ profile.user.name }}</h1>
                        <p class="email-mobile"><i class="fas fa-envelope"></i> {{ profile.user.email }}</p>
                        <p class="email-mobile"><i class="fas fa-phone"></i> {{ profile.user.mobile_no }}</p>
                        <p class="work-status">Status: {{ profile.user.work_status|capfirst }}</p>
                    </div>
                </div>

                <div class="profile-section">
                    <h2>Personal Details</h2>
                    <p><strong>Gender:</strong> {{ profile.gender|default:"N/A" }}</p>
                    <p><strong>Date of Birth:</strong> {{ profile.dob|date:"d-m-Y"|default:"N/A" }}</p>
                </div>

                <div class="profile-section">
                    <h2>Professional Information</h2>
                    <p><strong>Education:</strong> {{ profile.education|capfirst|default:"N/A" }}</p>
                    <p><strong>Work Experience:</strong> {{ profile.work_experience|default:"N/A" }}</p>
                </div>

                <div class="profile-section">
                    <h2>Skills & Expertise</h2>
                    <div class="skills-box view-mode">
                        {% if skills %}
                            {% for skill in skills %}
                                <span class="skill-tag view-mode">{{ skill }}</span>
                            {% endfor %}
                        {% else %}
                            <p>No skills added yet.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="profile-section">
                    <h2>Documents</h2>
                    <p><strong>Resume:</strong></p>
                    {% if profile.resume %}
                        <a href="{{ profile.resume.url }}" target="_blank" class="document-link"><i class="fas fa-file-pdf"></i> Download Resume</a>
                    {% else %}
                        <p>No resume uploaded.</p>
                    {% endif %}
                </div>

                <a href="?edit=1" class="btn">Edit Profile</a>
            </div>

        {% else %} <!-- is_editing is True -->
            <div class="container">
                <h2>Update Profile</h2>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    {% for field in form %}
                        {% if field.name not in 'photo resume skill_input' %}
                            <div class="mb-3">
                                {{ field.label_tag }}
                                {{ field }}
                                {% if field.errors %}
                                    <div class="text-danger">{{ field.errors }}</div>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}

                    <label for="skill-input">Skills:</label>
                    <input type="text" id="skill-input" placeholder="Type a skill and press Enter" />
                    <div class="skills-box" id="skills-container">
                        {% for skill in skills %}
                            <div class="skill-tag">{{ skill }}<span onclick="removeSkill(this)">Ã—</span>
                                <input type="hidden" name="skills[]" value="{{ skill }}" />
                            </div>
                        {% endfor %}
                    </div>

                    <div class="suggested-skills-section">
                        <p><strong>Select from suggested skills:</strong></p>
                        <div id="checkbox-container" class="checkbox-skills-grid">
                            {% for option in all_skills %}
                                <label class="checkbox-skill-label">
                                    <input
                                        type="checkbox"
                                        value="{{ option }}"
                                        onclick="toggleSkill(this)"
                                        {% if option in skills %} checked {% endif %} />
                                    {{ option }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>

                    <label>Profile Photo:</label>
                    <div class="current-photo-display">
                        {% if profile.photo %}
                            <img src="{{ profile.photo.url }}" alt="Current Profile Photo" width="120" height="120" />
                            <a href="#" class="remove-file-btn" onclick="document.getElementById('id_photo-clear').checked=true; this.style.display='none'; this.previousElementSibling.style.display='none';">Remove Photo</a>
                            <input type="checkbox" name="photo-clear" id="id_photo-clear" style="display: none;" />
                        {% endif %}
                        <input type="file" name="photo" accept="image/*" class="file-input" />
                    </div>

                    <label>Resume (PDF only):</label>
                    <div class="current-resume-display">
                        {% if profile.resume %}
                            <a href="{{ profile.resume.url }}" target="_blank" class="document-link"><i class="fas fa-file-pdf"></i> See Current Resume</a>
                            <a href="#" class="remove-file-btn" onclick="document.getElementById('id_resume-clear').checked=true; this.style.display='none'; this.previousElementSibling.style.display='none';">Remove Resume</a>
                            <input type="checkbox" name="resume-clear" id="id_resume-clear" style="display: none;" />
                        {% endif %}
                        <input type="file" name="resume" accept=".pdf" class="file-input" />
                    </div>

                    <button type="submit" class="btn">Save Profile</button>
                    <a href="{% url 'profile' %}" class="btn" style="background: none; border: 1px solid var(--primary-purple); color: var(--primary-purple); margin-top: 15px; box-shadow: none;">Cancel</a>
                </form>
            </div>
        {% endif %}
    </section>

    <!-- Hidden form for logout -->
    <form id="logoutForm" method="post" action="{% url 'logout' %}" class="logout-form">
        {% csrf_token %}
    </form>

    <script src="{% static 'js/profile.js' %}"></script>
</body>
</html>
